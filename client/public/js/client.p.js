var ABTest=function(window,document,undefined){!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.phpUnserialize=t()}(this,function(){"use strict";return function(e){var t,r=0,i=[],n=0,a=function(){var t=e.indexOf(":",r),i=e.substring(r,t);return r=t+2,parseInt(i,10)},o=function(){var t=e.indexOf(";",r),i=e.substring(r,t);return r=t+1,parseInt(i,10)},u=function(){var e=o();return i[n++]=e,e},s=function(){var t=e.indexOf(";",r),a=e.substring(r,t);return r=t+1,a=parseFloat(a),i[n++]=a,a},c=function(){var t=e.indexOf(";",r),a=e.substring(r,t);return r=t+1,a="1"===a,i[n++]=a,a},f=function(){for(var t,i,n=a(),o=0,u=0;n>u;)t=e.charCodeAt(r+o++),127>=t?u++:u+=t>2047?3:2;return i=e.substring(r,r+o),r+=o+2,i},l=function(){var e=f();return i[n++]=e,e},d=function(){var t=e.charAt(r);return r+=2,t},p=function(){var e=d();switch(e){case"i":return o();case"s":return f();default:throw{name:"Parse Error",message:"Unknown key type '"+e+"' at position "+(r-2)}}},h=function(){var e,o,u,s,c,f=a(),l=[],d={},h=l,m=n++;for(i[m]=h,u=0;f>u;u++)if(e=p(),o=t(),h===l&&parseInt(e,10)===u)l.push(o);else{if(h!==d){for(s=0,c=l.length;c>s;s++)d[s]=l[s];h=d,i[m]=h}d[e]=o}return r++,h},m=function(e,t){var r,i,n;return"\0"!==e.charAt(0)?e:(n=e.indexOf("\0",1),n>0?(r=e.substring(1,n),i=e.substr(n+1),"*"===r?i:t===r?i:r+"::"+i):void 0)},g=function(){var e,o,u,s,c={},l=n++,d=f();for(i[l]=c,e=a(),s=0;e>s;s++)o=m(p(),d),u=t(),c[o]=u;return r++,c},v=function(){var e=f(),t=f();return{__PHP_Incomplete_Class_Name:e,serialized:t}},_=function(){var e=o(),t=i[e-1];return i[n++]=t,t},w=function(){var e=o();return i[e-1]},O=function(){var e=null;return i[n++]=e,e};return(t=function(){var e=d();switch(e){case"i":return u();case"d":return s();case"b":return c();case"s":return l();case"a":return h();case"O":return g();case"C":return v();case"r":return _();case"R":return w();case"N":return O();default:throw{name:"Parse Error",message:"Unknown type '"+e+"' at position "+(r-2)}}})()}});var snippetParams=null,TIME_START=Date.now(),LOG=function(e,t){t===undefined&&(t="log"),document.location.search.indexOf("debug=abtest")>0&&console[t](e)},GTMPush=function(e,t){setTimeout(function(){"undefined"==typeof dataLayer&&(dataLayer=[]),dataLayer.push({event:"abTestParticipated",experimentId:"ABTest-"+e,experimentVariation:t})},1e3)},$ajax=function(e){try{var t=e.type||"GET";x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0"),x.timeout=snippetParams.library_tolerance(),x.open(t,e.url,!0),x.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"json"===e.dataType&&xmlHttp.setRequestHeader("Content-type","application/json"),x.onreadystatechange=function(){x.readyState>3&&e.success&&e.success(x.responseText,x)},x.send(e.data)}catch(r){LOG(r)}},userInCampaign=function(e,t){var r=t.cookies["_ABTest_exp_"+e.campaign_id+"_inc"],i=t.cookies["_ABTest_exp_"+e.campaign_id+"_exc"],n={participate:!0,campaign_id:e.campaign_id,included:1,var_id:r,variation:""};if(r!==undefined)return n;if(Object.keys(t.cookies).length>0&&i!==undefined)return n.participate=!1,n.included=0,n;var a=Math.floor(100*Math.random()+1);if(e.traffic>=a){var o=Math.floor(99*Math.random()),u=0;for(var s in e.variations){var c=e.variations[s];if(u+=parseInt(c.traffic),u>o){n.var_id=c.id,n.variation=c.name;break}}return n}return n.participate=!1,n.included=0,n},TargetMatcher=function(userBrowserInfo){var logic={criteria:{},userBrowserInfo:{},formatOutput:function(e,t,r,i){return{matched:e,criteria:t,value:r,run:i}},match:function(e){this.setCampaignCriteria(e);var t={};t.urlCriteria=this.matchUrl(),t.deviceCriteria=this.matchDevice(),t.browserCriteria=this.matchBrowser(),t.cookieCriteria=this.matchCookie(),t.userCriteria=this.matchUser(),t.ipCriteria=this.matchIP(),t.langCriteria=this.matchLanguage(),t.script=this.matchScript();var r=1,i={};for(var n in t)if(0==t[n].run){r=0,i[n]=t[n];break}return{execute:r,reason:i}},setCampaignCriteria:function(e){this.criteria={url:JSON.parse(e.url),device:JSON.parse(e.device),browser:JSON.parse(e.browser),geographic:e.geographic,cookie:JSON.parse(e.cookie),user:JSON.parse(e.user),ip:JSON.parse(e.ip),language:JSON.parse(e.language),script:JSON.parse(e.script)}},matchUrl:function(){var e=this,t={};if(this.criteria.url.url_excludes){var r=this.criteria.url.url_excludes;if(r.forEach(function(r){return e.userBrowserInfo.urlData.url.indexOf(r)>=0?(t=e.formatOutput(!0,"url_excludes",r,0),undefined):undefined}),t.hasOwnProperty("run"))return t}if(this.criteria.url.url_contains){var i=this.criteria.url.url_contains;if(i.forEach(function(r){return e.userBrowserInfo.urlData.url.indexOf(r)>=0?(t=e.formatOutput(!0,"url_includes",r,1),undefined):undefined}),t.hasOwnProperty("run"))return t}if(this.criteria.url.url){var n=this.removeLastSlash(this.userBrowserInfo.urlData.url),a=this.criteria.url.url;if(a.forEach(function(r){var i=r.charAt(0),a=r.charAt(r.length-1);if("/"==i&&"/"==a){if(n.match(r))return t=e.formatOutput(!0,"url_matched",r,1),undefined}else if(e.removeLastSlash(r)==n)return t=e.formatOutput(!0,"url_matched",r,1),undefined}),t.hasOwnProperty("run"))return t}return e.formatOutput(!1,"url_check",null,0)},matchDevice:function(){var e={matched:!1,criteria:"device_check",run:0},t="true"==this.criteria.device.allow_desktop,r="true"==this.criteria.device.allow_mobile,i="true"==this.criteria.device.allow_tablet,n=this.userBrowserInfo.device;return t&&"desktop"===n?e=this.formatOutput(!0,"device_check",n,1):r&&"phone"===n?e=this.formatOutput(!0,"device_check",n,1):i&&"tablet"===n?e=this.formatOutput(!0,"device_check",n,1):e},matchBrowser:function(){var e=this.userBrowserInfo.browserName,t={};if(this.criteria.browser){var r=this.criteria.browser;for(var i in r)if(r.hasOwnProperty(i)&&"true"==r[i]&&e.indexOf(i)>=0){t=this.formatOutput(!0,"browser_check",i,0);break}if(t.hasOwnProperty("run"))return t}return this.formatOutput(!1,"browser_check",null,1)},matchGeographic:function(){},matchCookie:function(){var e=this,t=!1,r=this.userBrowserInfo.cookies,i={};if(this.criteria.cookie){if(this.criteria.cookie.exclude_cookie&&this.criteria.cookie.exclude_cookie.length>0){var n=this.criteria.cookie.exclude_cookie;if(n.forEach(function(n){return r[n]?(t=!0,i=e.formatOutput(!0,"cookie_exclude",n,0),undefined):undefined}),i.hasOwnProperty("run"))return i}if(this.criteria.cookie.include_cookie&&this.criteria.cookie.include_cookie.length>0){var a=this.criteria.cookie.include_cookie;if(a.forEach(function(n){return r[n]?(t=!0,i=e.formatOutput(!0,"cookie_include",n,1),undefined):undefined}),i.hasOwnProperty("run"))return i}}return t?e.formatOutput(!1,"cookies",null,0):e.formatOutput(!1,"cookies",null,1)},matchUser:function(){var e=this,t=this.userBrowserInfo.cookies,r=!1,i={};if(this.criteria.user){if("true"==this.criteria.user.all_users)return e.formatOutput(!0,"user_match","all_users",1);if("true"==this.criteria.user.new_users){r=!1;for(var n in t)if(n.indexOf("_ABTest")>=0){i=e.formatOutput(!0,"user_match","new_user",0);break}if(i.hasOwnProperty("run"))return i}else if("true"==this.criteria.user.returning_users){r=!0;for(var n in t)if(n.indexOf("_ABTest")>=0){i=e.formatOutput(!0,"user_match","returning_user",1);break}if(i.hasOwnProperty("run"))return i}}return r?e.formatOutput(!1,"user_match",null,0):e.formatOutput(!1,"user_match",null,1)},matchIP:function(){var e=this.userBrowserInfo.ip,t=e.split("."),r={},i=this;if(this.criteria.ip){if(this.criteria.ip.exclude_ips&&this.criteria.ip.exclude_ips.length>0){var n=this.criteria.ip.exclude_ips;if(n.forEach(function(e){var n=e.split(".");n.length>0&&(r=i.formatOutput(!0,"ip_excludes",e,0),n.forEach(function(e,i){return"*"!=e&&t[i]!=e?(r={},undefined):undefined}))}),r.hasOwnProperty("run"))return r}if(this.criteria.ip.include_ips&&this.criteria.ip.include_ips.length>0){var a=this.criteria.ip.include_ips;if(a.forEach(function(e){var n=e.split(".");n.length>0&&(r=i.formatOutput(!0,"ip_includes",e,1),n.forEach(function(n,a){return"*"!=n&&t[a]!==n?(r=i.formatOutput(!1,"ip_includes",e,0),undefined):undefined}))}),r.hasOwnProperty("run"))return r}}return i.formatOutput(!1,"ip",null,1)},matchLanguage:function(){var e=this.userBrowserInfo.languages.toLowerCase(),t={},r=this;if(this.criteria.language){if(this.criteria.language.exclude_languages&&this.criteria.language.exclude_languages.length>0){var i=this.criteria.language.exclude_languages;if(i.forEach(function(i){return i.toLowerCase()==e?(t=r.formatOutput(!0,"lang_exclude",e,0),undefined):undefined}),t.hasOwnProperty("run"))return t}if(this.criteria.language.allowed_languages&&this.criteria.language.allowed_languages.length>0){var n=this.criteria.language.allowed_languages;if(t=r.formatOutput(!1,"lang_include",e,0),n.forEach(function(i){return i.toLowerCase()==e?(t=r.formatOutput(!0,"lang_include",e,1),undefined):undefined}),t.hasOwnProperty("run"))return t}}return r.formatOutput(!1,"language",null,1)},matchScript:function(){if(this.criteria.script){if(""==this.criteria.script.js)return this.formatOutput(!0,"script",null,1);if(eval(this.criteria.script.js))return this.formatOutput(!0,"script",null,1)}return this.formatOutput(!1,"script",null,0)},removeLastSlash:function(e){return"string"==typeof e&&"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),e}};return logic.userBrowserInfo=userBrowserInfo,logic};return{changes:[],preview:!1,host_name:"https://abclient.datastars.de/",documentUrl:null,executing:!1,snippetParams:null,loadjQuery:function(){LOG("Feature to be added - To load jquery","warn")},storeVariations:function(e){localStorage.setItem("_ABTest_V-"+e.participationObj.campaign_id,JSON.stringify(e))},getLocalCampaigns:function(){for(var e={},t=0;localStorage.length>t;t++){var r=localStorage.key(t);0===r.indexOf("_ABTest_V-")&&(e[r]=JSON.parse(localStorage.getItem(r)))}return e},setDocumentUrl:function(){var e=document.location.href.replace(document.location.search,"");this.documentUrl=this.removeLastSlash(e)},init:function(e,t){snippetParams=t,this.setDocumentUrl();try{"1"==this.getParameters("preview")&&""!=this.getParameters("cid")&&""!=this.getParameters("vid")?(LOG(Date.now()-TIME_START+" : Getting Preview"),this.getPreview(this.getParameters("cid"),this.getParameters("vid"))):(LOG(Date.now()-TIME_START+" : Getting Live"),this.getLive(e))}catch(r){LOG("There was an error."+(""+r),"warn")}},parseJSON:function(e){try{return JSON.parse(e)}catch(t){LOG("Error Parsing JSON","warn")}},serverRequest:function(e){var t=this;$ajax({url:t.host_name+"running?account_id="+e,success:function(e){var e=t.parseJSON(e);e?(LOG(Date.now()-TIME_START+" : OK from server"),e.browserInfo&&e.campaigns&&e.campaigns.length>0?(e.browserInfo.cookies=t.getAllCookies(),e.browserInfo.urlData.referrer=document.referrer,e.browserInfo.urlData.url=t.documentUrl,TargetMatcher.prototype.userBrowserInfo=e.browserInfo,e.campaigns.forEach(function(r){LOG(Date.now()-TIME_START+" : Checking if experiment will run now or next time");var i=t.willCampaignRun(r,e.browserInfo);LOG(i),i.execute?(LOG(Date.now()-TIME_START+" : experiment passed targetting criteria"),r.variations=t.removePausedVariations(phpUnserialize(r.variations)),LOG(Date.now()-TIME_START+" : Checking participation status"),r.participationObj=userInCampaign(r,e.browserInfo),r.participationObj.participate?(LOG(Date.now()-TIME_START+" : User Participates"),t.execute(r)):(LOG(Date.now()-TIME_START+" : User is excluded"),t.setCookie("_ABTest_exp_"+r.campaign_id+"_exc",1))):t.campaignCleanUp(r)})):t.campaignCleanUp()):LOG(Date.now()-TIME_START+" : No Experiments found from server")}})},removePausedVariations:function(e){for(var t in e)"true"==e[t].paused&&delete e[t];return e},getLive:function(e){var t=this,r=t.getLocalCampaigns();t.executed=!1;var i=Object.keys(r).length;0==i?(t.serverRequest(e),LOG(Date.now()-TIME_START+" : No experiments found in LocalStorage")):LOG(Date.now()-TIME_START+" : Experiments found in LocalStorage");for(var n in r)t.execute(r[n],function(){i--,0==i&&(LOG(Date.now()-TIME_START+" : Getting latest updates from server and updating the client"),t.serverRequest(e))})},campaignCleanUp:function(e){if(e===undefined)for(var t=0;localStorage.length>t;t++){var r=localStorage.key(t);0===r.indexOf("_ABTest_V-")&&localStorage.removeItem(r)}else localStorage.removeItem("_ABTest_V-"+e.campaign_id)},willCampaignRun:function(e,t){var r=new TargetMatcher(t);return r.match(e)},removeLastSlash:function(e){return"string"==typeof e&&"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),e},getPreview:function(e,t){var r=this;r.preview=!0,$ajax({url:r.host_name+"running?preview=1&cid="+e,success:function(e){var e=r.parseJSON(e);e&&e.browserInfo&&e.campaigns&&(e.browserInfo.cookies=r.getAllCookies(),e.browserInfo.urlData.referrer=document.referrer,e.browserInfo.urlData.url=document.location.origin,e.campaigns.forEach(function(i){var n=r.willCampaignRun(i,e.browserInfo);LOG(n),n.execute&&(i.variations=phpUnserialize(i.variations),i.participationObj={participate:!0,campaign_id:i.campaign_id,included:1,var_id:t,variation:""},r.execute(i))}))}})},timeoutDetected:function(){LOG(Date.now()-TIME_START+" : Timeout detected")},execute:function(e,t){function r(e,t,r){var i=t.variations[t.participationObj.var_id];if(i==undefined)return r(status),undefined;var n=null===document.getElementById("_abtest_path_hides");return n?(e.timeoutDetected(),undefined):(e.runJS(i.js,function(n){LOG(Date.now()-TIME_START+" : Injected Javascript"),e.runCSS(i.css),LOG(Date.now()-TIME_START+" : Injected CSS"),e.preview||(e.storeVariations(t),GTMPush(t.participationObj.campaign_id,i.id),e.setCookie("_ABTest_exp_"+t.participationObj.campaign_id+"_inc",t.participationObj.var_id)),"function"==typeof r&&(LOG(Date.now()-TIME_START+" : Executed experiment from LocalStorage"),r(n))}),undefined)}var i=this;try{i.executing?(i.storeVariations(e),"function"==typeof t&&t(!0)):(r(i,e,t),i.executing=!0)}catch(n){}},runJS:function(js,callback){eval(js),callback(!0)},runCSS:function(e){var t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)},jQueryLoaded:function(e){var t=setInterval(function(){"undefined"!=typeof jQuery&&(clearInterval(t),e(!0))},5);setTimeout(function(){"undefined"==typeof jQuery&&(LOG("Jquery didnt load on time!","warn"),e(!1)),clearInterval(t)},600)},setCookie:function(e,t){var r=new Date;r=new Date(r.getTime()+864e7),document.cookie=e+"="+t+";expires="+r.toGMTString()+";path=/"},removeCookie:function(e,t,r){document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(r?"; domain="+r:"")+(t?"; path="+t:"")},getAllCookies:function(){var e={};return document.cookie.split(";").forEach(function(t){if(""==t)return{};var r=t.split("=");e[r[0].trim()]=r[1].trim()}),e},getParameters:function(e){for(var t={},r=window.location.search.substring(1),i=r.split("&"),n=0;i.length>n;n++){var a=i[n].split("=");if(t[a[0]]===undefined)t[a[0]]=decodeURIComponent(a[1]);else if("string"==typeof t[a[0]]){var o=[t[a[0]],decodeURIComponent(a[1])];t[a[0]]=o}else t[a[0]].push(decodeURIComponent(a[1]))}return t[e]===undefined?null:t[e]}}}(window,document);window.ABTest=window.$_ABTest=ABTest;